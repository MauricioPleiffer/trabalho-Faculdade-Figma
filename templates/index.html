<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lave J√° - Lavanderia</title>
    <!-- CSS do projeto -->

    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Estilos inline para algumas coisas -->
    <style>
        /* Estilos b√°sicos */
    </style>
    <!-- SDK opcional do Google para visualiza√ß√£o do bot√£o -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>

    {% if request.args.get('status') == 'sucesso' %}
        <div id="alerta-sucesso" class="alerta-sucesso">
            Pagamento realizado com sucesso!
        </div>
    {% endif %}

    <!-- Cabe√ßalho do site -->
    <header>
        <div class="header">
            <div class="logo">
                <img src="{{ url_for('static', filename='imagem/lave.ja.png') }}" alt="Logo Lave J√°" width="60"
                    style="border-radius: 5px;">
            </div>
            <nav>
                <a href="{{ url_for('catalogo_page') }}" class="botao">CATALOGO</a>
                <button id="loginBtn" class="botao-login">Login</button>
                {% if session.usuario %}
                <p class="user-info">
                    Bem-vindo, {{ session.usuario.nome }}
                    {% if session.usuario.tipo_login == 'google' %}
                    <span style="color: #4285F4;">(Google)</span>
                    {% endif %}
                </p>
                {% endif %}
            </nav>
        </div>
    </header>

    <!-- Se√ß√£o principal -->
    <main>
        <section class="principal">
            <div class="conteudo-principal">
                <div class="texto-principal">
                    <h1>Lave J√° - Sua Lavanderia de Confian√ßa</h1>
                    <p>Servi√ßos profissionais de lavagem, passadoria e entrega. Cuide das suas roupas com quem entende
                        do assunto.</p>
                    <div class="botoes">
                        <a href="#contato" class="botao-principal">Solicitar Servi√ßo</a>
                        <a href="#servicos" class="botao-secundario">Ver Servi√ßos</a>
                    </div>
                </div>
                <div class="imagem-principal">
                    <img src="{{ url_for('static', filename='imagem/lavanderia.jpg') }}" alt="Lavanderia Lave J√°">
                </div>
            </div>
        </section>

        <!-- Se√ß√£o de servi√ßos -->
        <section id="servicos">
            <div class="servicos">
                <div class="servico">
                    <img src="{{ url_for('static', filename='imagem/imagem2.jpg') }}" alt="Lavagem de roupas">
                    <h3>Lavagem Profissional</h3>
                    <p>Roupas limpas e higienizadas com produtos de qualidade.</p>
                </div>
                <div class="servico">
                    <img src="{{ url_for('static', filename='imagem/roup.passad.avif') }}" alt="Passadoria de roupas">
                    <h3>Passadoria Completa</h3>
                    <p>Roupas passadas e dobradas com cuidado e perfei√ß√£o.</p>
                </div>
                <div class="servico">
                    <img src="{{ url_for('static', filename='imagem/unnamed.png') }}" alt="Servi√ßos de lavanderia">
                    <h3>Entrega R√°pida</h3>
                    <p>Coleta e entrega no prazo combinado, sempre pontual.</p>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o de pre√ßos -->
        <section id="precos" class="precos">
            <div class="cards-precos">
                <div class="card-preco">
                    <h4>Lavagem Simples</h4>
                    <p class="preco">R$15<span>/kg</span></p>
                    <a href="#carrinho" class="botao">Solicitar</a>
                </div>
                <div class="card-preco destaque">
                    <h4>Lavagem + Passadoria</h4>
                    <p class="preco">R$25<span>/kg</span></p>
                    <a href="#carrinho" class="botao">Solicitar</a>
                </div>
                <div class="card-preco">
                    <h4>Servi√ßo Completo</h4>
                    <p class="preco">Sob consulta</p>
                    <a href="#contato" class="botao-secundario">Contato</a>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o sobre -->
        <section id="sobre">
            <div class="sobre">
                <div class="texto-sobre">
                    <h2>Sobre a Lave J√°</h2>
                    <p>Somos uma lavanderia moderna e confi√°vel, especializada em cuidar das suas roupas com carinho e
                        profissionalismo. Oferecemos servi√ßos completos de lavagem, passadoria e entrega, sempre
                        pensando na comodidade dos nossos clientes.</p>
                    <p>Com anos de experi√™ncia no mercado, garantimos qualidade, pontualidade e satisfa√ß√£o total em cada
                        servi√ßo prestado.</p>
                </div>
                <div class="imagem-sobre">
                    <img src="{{ url_for('static', filename='imagem/unnamed (1).png') }}" alt="Sobre a Lave J√°">
                </div>
            </div>
        </section>
    </main>

    <!-- Rodap√© (restaurado) -->
    <footer class="footer-completo">
        <div class="container-footer">
            <!-- Se√ß√£o Contato -->
            <div class="footer-section">
                <h3>Contato</h3>
                <div class="contato-item">
                    <i class="icon">üìû</i>
                    <span>(11) 99999-9999</span>
                </div>
                <div class="contato-item">
                    <i class="icon">üìß</i>
                    <span>contato@laveja.com.br</span>
                </div>
                <div class="contato-item">
                    <i class="icon">üïí</i>
                    <span>Seg - Sex: 8h √†s 18h<br>S√°b: 8h √†s 12h</span>
                </div>
            </div>

            <!-- Se√ß√£o Localiza√ß√£o -->
            <div class="footer-section">
                <h3>Localiza√ß√£o</h3>
                <div class="contato-item">
                    <i class="icon">üìç</i>
                    <span>Rua das Lavanderias, 123<br>Centro - S√£o Paulo/SP<br>CEP: 01234-567</span>
                </div>
                <div class="contato-item">
                    <i class="icon">üöó</i>
                    <span>Estacionamento gratuito<br>para clientes</span>
                </div>
            </div>

            <!-- Se√ß√£o Sobre -->
            <div class="footer-section">
                <h3>Sobre a LaveJ√°</h3>
                <p>Somos uma lavanderia familiar com mais de 15 anos de experi√™ncia no mercado. Nossa miss√£o √© cuidar
                    das suas roupas com carinho e profissionalismo.</p>
                <div class="redes-sociais">
                    <a href="#" class="rede-social">Facebook</a>
                    <a href="#" class="rede-social">Instagram</a>
                    <a href="#" class="rede-social">Twitter</a>
                </div>
            </div>

            <!-- Se√ß√£o WhatsApp -->
            <div class="footer-section whatsapp-section">
                <h3>Fale Conosco</h3>
                <p>Precisa de ajuda? Entre em contato pelo WhatsApp!</p>
                <a href="https://wa.me/5511999999999?text=Ol√°! Gostaria de solicitar um servi√ßo da LaveJ√°"
                    target="_blank" rel="noopener" class="botao-whatsapp">WhatsApp</a>
                <p class="whatsapp-info">Resposta r√°pida em at√© 5 minutos</p>
            </div>
        </div>

        <!-- Linha de copyright -->
        <div class="footer-bottom">
            <p>¬© 2025 LaveJ√° - Lavanderia Profissional. Todos os direitos reservados.</p>
            <p>Desenvolvido com ‚ù§Ô∏è para cuidar das suas roupas</p>
        </div>
    </footer>

    <!-- Modal de Login (restaurado) -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Entrar na sua conta</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="input-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" placeholder="seu@email.com" required>
                    </div>
                    <div class="input-group">
                        <label for="senha">Senha:</label>
                        <input type="password" id="senha" placeholder="Sua senha" required>
                    </div>
                    <div class="form-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="lembrar"> Lembrar-me
                        </label>
                        <a href="#" class="esqueci-senha">Esqueci minha senha</a>
                    </div>
                    <button type="submit" class="botao-login-modal">Entrar</button>
                </form>
                <div class="divider">
                    <span>ou</span>
                </div>
                <div class="social-login">
                    <a href="/google_login" class="botao-social google" id="googleLoginBtn">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google"
                            width="20" style="vertical-align: middle; margin-right: 8px;">
                        Entrar com Google
                    </a>
                    <button class="botao-social facebook">Entrar com Facebook</button>
                </div>
                <div class="cadastro-link">
                    <p>N√£o tem uma conta? <a href="#" id="cadastroLink">Cadastre-se aqui</a></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ------ Login via Flask (substitui o login localStorage) ------
let usuarioLogado = null;

function abrirLogin(){ var m = document.getElementById('loginModal'); if(m) m.style.display = 'block'; }
function fecharLogin(){ var m = document.getElementById('loginModal'); if(m) m.style.display = 'none'; }

function atualizarBotao(){ 
    var b = document.getElementById('loginBtn'); 
    if(!b) return; 
    if(usuarioLogado){ 
        b.textContent = 'Ol√°, ' + usuarioLogado.nome; 
        b.style.backgroundColor = '#28a745'; 
    } else { 
        b.textContent = 'Login'; 
        b.style.backgroundColor = ''; 
    } 
}

window.addEventListener('load', function () {
    atualizarBotao();
window
    var loginBtn = document.getElementById('loginBtn');
    if (loginBtn) loginBtn.onclick = function () { 
        if (usuarioLogado) { 
            if (confirm('Deseja sair?')) { 
                // logout simples: pedir ao servidor para limpar sess√£o (opcional)
                fetch('/auth/logout', { method: 'POST' })
                    .then(()=> { usuarioLogado = null; atualizarBotao(); location.reload(); })
                    .catch(()=> { usuarioLogado = null; atualizarBotao(); location.reload(); });
            } 
        } else { abrirLogin(); } 
    };

    var closeLogin = document.querySelector('.close'); if (closeLogin) closeLogin.onclick = fecharLogin;

    var formLogin = document.getElementById('loginForm');
    if (formLogin) formLogin.onsubmit = async function (e) {
        e.preventDefault();
        const email = document.getElementById('email').value.trim();
        const senha = document.getElementById('senha').value;
        const lembrar = document.getElementById('lembrar') && document.getElementById('lembrar').checked;

        try {
            const resp = await fetch('/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: email, senha: senha })
            });
            const data = await resp.json();
            if (data.ok) {
                // login bem sucedido
                // opcional: atualizar vari√°vel local para exibir nome sem recarregar
                usuarioLogado = { nome: data.usuario_nome || email };
                atualizarBotao();
                fecharLogin();
                window.location.href = '/'; // redireciona para home
            } else {
                alert(data.msg || 'Email ou senha incorretos.');
            }
        } catch (err) {
            console.error(err);
            alert('Erro de conex√£o ao tentar logar.');
        }
    };

    // cadastroLink continua igual
    var cadastroLink = document.getElementById('cadastroLink'); 
    if (cadastroLink) { 
        cadastroLink.onclick = function (e) { 
            e.preventDefault(); 
            window.location.href = '/cadastro'; 
        }; 
    }

    // bot√£o Google continua redirecionando para /google_login
    var socialGoogle = document.querySelector('.botao-social.google');
    if (socialGoogle) {
        socialGoogle.onclick = function () {
            window.location.href = '/google_login';
        };
    }
});
// ---------------------------------------------------------------

        // --- Carrinho simples (persistido em localStorage) ---
        (function () {
            var cart = [];
            var cartCountEl = document.getElementById('cartCount');
            var cartItemsEl = document.getElementById('cartItems');
            var cartEmptyEl = document.getElementById('cartEmpty');
            var cartActionsEl = document.getElementById('cartActions');
            var clearBtn = document.getElementById('clearCart');
            var checkoutBtn = document.getElementById('checkout');

            function save() { localStorage.setItem('laveja_cart', JSON.stringify(cart)); }
            function load() { var raw = localStorage.getItem('laveja_cart'); if (raw) cart = JSON.parse(raw); else cart = []; }

            function updateUI() {
                if (!cartCountEl) return;
                cartCountEl.textContent = cart.length;
                if (cart.length === 0) {
                    if (cartItemsEl) cartItemsEl.style.display = 'none';
                    if (cartActionsEl) cartActionsEl.style.display = 'none';
                    if (cartEmptyEl) { cartEmptyEl.style.display = 'block'; cartEmptyEl.textContent = 'Seu carrinho est√° vazio.'; }
                } else {
                    if (cartItemsEl) {
                        cartItemsEl.innerHTML = '';
                        cart.forEach(function (it, idx) {
                            var li = document.createElement('li');
                            li.className = 'cart-item';
                            var left = document.createElement('div'); left.className = 'name'; left.textContent = it.name;
                            var right = document.createElement('div'); right.className = 'price';
                            // Formatar pre√ßo como moeda
                            var priceNum = Number(it.price) || 0;
                            right.textContent = 'R$ ' + priceNum.toFixed(2).replace('.', ',');
                            li.appendChild(left); li.appendChild(right); cartItemsEl.appendChild(li);
                        });
                        cartItemsEl.style.display = 'block';
                    }
                    if (cartActionsEl) cartActionsEl.style.display = 'flex';
                    if (cartEmptyEl) cartEmptyEl.style.display = 'none';
                }
            }

            function addItem(item) { cart.push(item); save(); updateUI(); }
            function clearCart() { cart = []; save(); updateUI(); }

            function scapeHtml(str) {
                return String(str).replace(/[&<>"'`=\/]/g, function (s) {
                    return ({
                        '&': '&amp;',
                        '<': '&lt;',
                        '>': '&gt;',
                        '"': '&quot;',
                        "'": "&#39;",
                        "/": "&#47;",
                        "=": "&#61;",
                        "`": "&#96;"
                    }
                    [s]);
                });
            }

            function adicionar(servico_id) {
                // Chama o endpoint Flask que adiciona o servi√ßo √† sess√£o no servidor
                fetch('/adicionar_ao_carrinho', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: 'servico_id=' + encodeURIComponent(servico_id)
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.sucesso) {
                            // Atualiza a √°rea do carrinho com os dados retornados
                            const carrinhoDiv = document.getElementById('carrinho');
                            if (carrinhoDiv) {
                                carrinhoDiv.innerHTML = `
                            <p>${data.nome} - R$ ${Number(data.preco).toFixed(2)}</p>
                            <p><strong>Total: R$ ${Number(data.total).toFixed(2)}</strong></p>
                        `;
                            }
                        } else {
                            alert('Erro: ' + (data.mensagem || 'N√£o foi poss√≠vel adicionar o servi√ßo'));
                        }
                    })
                    .catch(err => {
                        console.error('Erro ao adicionar:', err);
                        alert('Erro de conex√£o ao adicionar ao carrinho.');
                    });
            }

            // Expor addItem para uso nos bot√µes de servi√ßo
            // Agora substitui o carrinho pelo √∫ltimo servi√ßo solicitado (comportamento pedido)
            window.lavejaAddToCart = function (id, name, price) {
                // Normalizar o pre√ßo para n√∫mero
                var p = Number(price) || 0;
                // Substitui o carrinho atual pelo novo item solicitado
                cart = [{ id: id, name: name, price: p }];
                // Persiste e atualiza a interface
                save();
                updateUI();
                // Mensagem curta ao usu√°rio
                alert('Servi√ßo solicitado: ' + name + ' ‚Äî R$ ' + p.toFixed(2).replace('.', ','));
            };

            if (clearBtn) clearBtn.onclick = function () { if (confirm('Limpar carrinho?')) clearCart(); };
            if (checkoutBtn) checkoutBtn.onclick = function () {
                if (cart.length === 0) { alert('Carrinho vazio!'); return; }
                // Chamar o endpoint Flask que finaliza a compra
                fetch('/finalizar_compra', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cart: cart })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.sucesso) {
                            alert(data.mensagem);
                            clearCart();
                        } else {
                            alert('Erro ao finalizar compra: ' + (data.mensagem || 'Erro desconhecido'));
                        }
                    })
                    .catch(err => alert('Erro de conex√£o: ' + err));
            };

            // Inicializar
            load(); updateUI();
        })();
    </script>

    <script>
        setTimeout(function() {
            let alerta = document.getElementById("alerta-sucesso");
            if (alerta) {
                alerta.remove();
            }
        }, 3000);
    </script>

</body>

</html>